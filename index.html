<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Entreno Pablo">
    <title>Powerbuilding 6M - Pablo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #020617; 
            color: #f8fafc; 
            margin: 0;
            padding: 0;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @keyframes pulse-green { 
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 0 20px 10px rgba(16, 185, 129, 0); }
        }
        
        .pulse-success { animation: pulse-green 1s ease-in-out; }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        
        #loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #020617;
            text-align: center;
            padding: 20px;
        }

        .btn-active:active { transform: scale(0.95); }
        
        .install-prompt, .modal-overlay {
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root">
        <div id="loader">
            <i class="fas fa-dumbbell fa-spin fa-3x text-blue-500 mb-4"></i>
            <p class="text-slate-500 font-bold uppercase tracking-widest text-xs">Cargando Entreno Pablo...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // URL del Google Apps Script - LA MISMA QUE YA TEN√âS
        const SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbz3siWBIiF9wKtMdlYgkrcRkuVuabN85fRv-Y0ntXbuu7AysFi04jqvGnUqA_6r7-kI/exec';
        const SHEET_ID = '1pL_OytXJ-Em6iAdg13PppBj7TlPtdMBMaCbIs5quh1E';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/edit`;

        // BASE DE DATOS DE ALIMENTOS (valores por 100g)
        const FOOD_DATABASE = {
            'pollo': { kcal: 165, protein: 31, carbs: 0, fat: 3.6 },
            'carne': { kcal: 250, protein: 26, carbs: 0, fat: 15 },
            'pescado': { kcal: 206, protein: 22, carbs: 0, fat: 12 },
            'huevo': { kcal: 155, protein: 13, carbs: 1, fat: 11 },
            'atun': { kcal: 132, protein: 28, carbs: 0, fat: 1 },
            'arroz': { kcal: 130, protein: 2.7, carbs: 28, fat: 0.3 },
            'pasta': { kcal: 131, protein: 5, carbs: 25, fat: 1.1 },
            'papa': { kcal: 77, protein: 2, carbs: 17, fat: 0.1 },
            'pan': { kcal: 265, protein: 9, carbs: 49, fat: 3.2 },
            'avena': { kcal: 389, protein: 17, carbs: 66, fat: 7 },
            'brocoli': { kcal: 34, protein: 2.8, carbs: 7, fat: 0.4 },
            'espinaca': { kcal: 23, protein: 2.9, carbs: 3.6, fat: 0.4 },
            'lechuga': { kcal: 15, protein: 1.4, carbs: 2.9, fat: 0.2 },
            'tomate': { kcal: 18, protein: 0.9, carbs: 3.9, fat: 0.2 },
            'leche': { kcal: 42, protein: 3.4, carbs: 5, fat: 1 },
            'yogur': { kcal: 59, protein: 10, carbs: 3.6, fat: 0.4 },
            'queso': { kcal: 402, protein: 25, carbs: 1.3, fat: 33 },
            'banana': { kcal: 89, protein: 1.1, carbs: 23, fat: 0.3 },
            'manzana': { kcal: 52, protein: 0.3, carbs: 14, fat: 0.2 },
            'palta': { kcal: 160, protein: 2, carbs: 9, fat: 15 }
        };

        function App() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [loginError, setLoginError] = useState('');
            const [loading, setLoading] = useState(true);
            
            const [currentWeek, setCurrentWeek] = useState(1);
            const [completedSets, setCompletedSets] = useState({});
            const [initialWeights, setInitialWeights] = useState({ sentadilla: 100, muerto: 100, pecho: 80 });
            const [workoutHistory, setWorkoutHistory] = useState([]);
            
            const [timer, setTimer] = useState(0);
            const [isTimerActive, setIsTimerActive] = useState(false);
            const [targetTime, setTargetTime] = useState(180);
            
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [currentView, setCurrentView] = useState('workout');
            
            const [syncStatus, setSyncStatus] = useState('idle');
            const [lastSync, setLastSync] = useState(null);
            
            // ESTADOS ACTIVIDAD
            const [runningActivities, setRunningActivities] = useState([]);
            const [footballActivities, setFootballActivities] = useState([]);
            const [showRunningModal, setShowRunningModal] = useState(false);
            const [showFootballModal, setShowFootballModal] = useState(false);
            
            // ESTADOS NUTRICI√ìN - NUEVOS
            const [meals, setMeals] = useState([]);
            const [showMealModal, setShowMealModal] = useState(false);
            const [bodyGoals, setBodyGoals] = useState({
                weightGoal: 0,
                fatPercentGoal: 0,
                musclePercentGoal: 0
            });
            
            // ESTADOS MEDICIONES - NUEVOS
            const [measurements, setMeasurements] = useState([]);
            const [showMeasurementModal, setShowMeasurementModal] = useState(false);
            
            // ESTADOS HIDRATACI√ìN - NUEVOS
            const [waterIntake, setWaterIntake] = useState({});
            const [waterGoal, setWaterGoal] = useState(3000);
            
            // ESTADOS BIENESTAR - NUEVOS
            const [wellness, setWellness] = useState({});
            const [showWellnessModal, setShowWellnessModal] = useState(false);
            
            // ESTADOS V4 - CALENDARIO Y COACHING
            const [customFoods, setCustomFoods] = useState({});
            const [coachingNotes, setCoachingNotes] = useState([]);
            const [calendarView, setCalendarView] = useState(new Date());
            const [selectedDay, setSelectedDay] = useState(null);
            const [showDayModal, setShowDayModal] = useState(false);
                        
            const timerIntervalRef = useRef(null);

            // Funci√≥n sincronizar
            const syncToSheets = useCallback(async (data) => {
                try {
                    setSyncStatus('syncing');
                    console.log('üì§ Enviando a Sheets:', data.action);
                    
                    const response = await fetch(SHEETS_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    console.log('üì• Respuesta de Sheets:', result);
                    
                    if (result.success || result.config) {
                        setSyncStatus('success');
                        setLastSync(new Date());
                        setTimeout(() => setSyncStatus('idle'), 2000);
                        return true;
                    } else {
                        console.error('‚ùå Error en respuesta:', result);
                        setSyncStatus('error');
                        setTimeout(() => setSyncStatus('idle'), 3000);
                        return false;
                    }
                } catch (error) {
                    console.error('‚ùå Error sync:', error);
                    setSyncStatus('error');
                    setTimeout(() => setSyncStatus('idle'), 3000);
                    return false;
                }
            }, []);

            // PWA Install
            useEffect(() => {
                const handler = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                    if (!window.matchMedia('(display-mode: standalone)').matches) {
                        setTimeout(() => setShowInstallPrompt(true), 2000);
                    }
                };
                window.addEventListener('beforeinstallprompt', handler);
                return () => window.removeEventListener('beforeinstallprompt', handler);
            }, []);

            const handleInstall = async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                await deferredPrompt.userChoice;
                setDeferredPrompt(null);
                setShowInstallPrompt(false);
            };

            // Cargar datos
            useEffect(() => {
                try {
                    const savedSession = localStorage.getItem('pablo_session');
                    const savedWeek = localStorage.getItem('pablo_currentWeek');
                    const savedSets = localStorage.getItem('pablo_completedSets');
                    const savedWeights = localStorage.getItem('pablo_initialWeights');
                    const savedHistory = localStorage.getItem('pablo_workoutHistory');
                    const savedTargetTime = localStorage.getItem('pablo_targetTime');
                    const savedLastSync = localStorage.getItem('pablo_lastSync');
                    const savedRunning = localStorage.getItem('pablo_runningActivities');
                    const savedFootball = localStorage.getItem('pablo_footballActivities');
                    const savedMeals = localStorage.getItem('pablo_meals');
                    const savedGoals = localStorage.getItem('pablo_bodyGoals');
                    const savedMeasurements = localStorage.getItem('pablo_measurements');
                    const savedWater = localStorage.getItem('pablo_waterIntake');
                    const savedWaterGoal = localStorage.getItem('pablo_waterGoal');
                    const savedWellness = localStorage.getItem('pablo_wellness');

                    if (savedSession === 'active') setIsLoggedIn(true);
                    if (savedWeek) setCurrentWeek(parseInt(savedWeek));
                    if (savedSets) setCompletedSets(JSON.parse(savedSets));
                    if (savedWeights) setInitialWeights(JSON.parse(savedWeights));
                    if (savedHistory) setWorkoutHistory(JSON.parse(savedHistory));
                    if (savedTargetTime) setTargetTime(parseInt(savedTargetTime));
                    if (savedLastSync) setLastSync(new Date(savedLastSync));
                    if (savedRunning) setRunningActivities(JSON.parse(savedRunning));
                    if (savedFootball) setFootballActivities(JSON.parse(savedFootball));
                    if (savedMeals) setMeals(JSON.parse(savedMeals));
                    if (savedGoals) setBodyGoals(JSON.parse(savedGoals));
                    if (savedMeasurements) setMeasurements(JSON.parse(savedMeasurements));
                    if (savedWater) setWaterIntake(JSON.parse(savedWater));
                    if (savedWaterGoal) setWaterGoal(parseInt(savedWaterGoal));
                    if (savedWellness) setWellness(JSON.parse(savedWellness));
                } catch (err) {
                    console.error('Error cargando datos:', err);
                }
                
                // Cargar custom foods V4
                loadCustomFoods();
                
                setLoading(false);
            }, []);

            // Guardar datos
            const saveData = useCallback((updates = {}) => {
                try {
                    Object.keys(updates).forEach(key => {
                        const storageKey = `pablo_${key}`;
                        const value = updates[key];
                        if (typeof value === 'object') {
                            localStorage.setItem(storageKey, JSON.stringify(value));
                        } else {
                            localStorage.setItem(storageKey, value);
                        }
                    });
                } catch (err) {
                    console.error('Error guardando datos:', err);
                }
            }, []);

            // Timer
            useEffect(() => {
                if (isTimerActive && timer > 0) {
                    timerIntervalRef.current = setInterval(() => {
                        setTimer(t => {
                            if (t <= 1) {
                                setIsTimerActive(false);
                                if ('vibrate' in navigator) navigator.vibrate([200, 100, 200]);
                                if ('Notification' in window && Notification.permission === 'granted') {
                                    new Notification('¬°Descanso terminado!', {
                                        body: 'Es hora de la siguiente serie',
                                        vibrate: [200, 100, 200]
                                    });
                                }
                                return 0;
                            }
                            return t - 1;
                        });
                    }, 1000);
                } else {
                    if (timerIntervalRef.current) clearInterval(timerIntervalRef.current);
                }
                return () => {
                    if (timerIntervalRef.current) clearInterval(timerIntervalRef.current);
                };
            }, [isTimerActive, timer]);

            const startTimer = useCallback(() => {
                setTimer(targetTime);
                setIsTimerActive(true);
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }, [targetTime]);

            const stopTimer = useCallback(() => {
                setIsTimerActive(false);
            }, []);

            const toggleSet = useCallback(async (dayId, exerciseName, setIndex, isWarmup = false, weight = 0, totalSets = 0, reps = 0) => {
                const key = `${currentWeek}-${dayId}-${exerciseName}-${isWarmup ? 'warmup' : 'work'}-${setIndex}`;
                const newCompletedSets = { ...completedSets, [key]: !completedSets[key] };
                setCompletedSets(newCompletedSets);
                saveData({ completedSets: newCompletedSets });
                
                await syncToSheets({
                    action: 'log_set',
                    week: currentWeek,
                    day: dayId,
                    exercise: exerciseName,
                    weight: weight,
                    totalSets: totalSets,
                    reps: reps,
                    setNumber: setIndex + 1,
                    isWarmup: isWarmup,
                    completed: !completedSets[key]
                });
                
                if (!isWarmup && !completedSets[key]) {
                    startTimer();
                }
                
                if (!completedSets[key]) {
                    const newHistory = [...workoutHistory, {
                        date: new Date().toISOString(),
                        week: currentWeek,
                        day: dayId,
                        exercise: exerciseName,
                        setNumber: setIndex + 1,
                        isWarmup
                    }];
                    setWorkoutHistory(newHistory);
                    saveData({ workoutHistory: newHistory });
                }
            }, [currentWeek, completedSets, saveData, syncToSheets, startTimer, workoutHistory]);

            const stats = useMemo(() => {
                const weekInCycle = ((currentWeek - 1) % 4) + 1;
                const cycleNumber = Math.floor((currentWeek - 1) / 4);
                
                const setsReps = [
                    { sets: 5, reps: 5 },
                    { sets: 6, reps: 6 },
                    { sets: 7, reps: 7 },
                    { sets: 8, reps: 8 }
                ];
                
                const current = setsReps[weekInCycle - 1];
                const increment = cycleNumber * 2.5;
                
                return {
                    sets: current.sets,
                    reps: current.reps,
                    increment: increment
                };
            }, [currentWeek]);

            // CALCULAR MACROS DE ALIMENTO - NUEVO
            const calculateFoodMacros = useCallback((foodName, grams) => {
                const normalized = foodName.toLowerCase().trim();
                const food = FOOD_DATABASE[normalized];
                
                if (food) {
                    const multiplier = grams / 100;
                    return {
                        kcal: Math.round(food.kcal * multiplier),
                        protein: Math.round(food.protein * multiplier * 10) / 10,
                        carbs: Math.round(food.carbs * multiplier * 10) / 10,
                        fat: Math.round(food.fat * multiplier * 10) / 10
                    };
                }
                return null;
            }, []);

            // NUTRICI√ìN DIARIA - NUEVO
            const getDailyNutrition = useCallback(() => {
                const today = new Date().toDateString();
                const todayMeals = meals.filter(m => new Date(m.date).toDateString() === today);
                
                return todayMeals.reduce((acc, meal) => ({
                    kcal: acc.kcal + meal.kcal,
                    protein: acc.protein + meal.protein,
                    carbs: acc.carbs + meal.carbs,
                    fat: acc.fat + meal.fat
                }), { kcal: 0, protein: 0, carbs: 0, fat: 0 });
            }, [meals]);

            // AGUA DEL D√çA - NUEVO
            const getTodayWater = useCallback(() => {
                const today = new Date().toDateString();
                return waterIntake[today] || 0;
            }, [waterIntake]);

            // AGREGAR AGUA - NUEVO
            const addWater = useCallback((ml) => {
                const today = new Date().toDateString();
                const newIntake = { ...waterIntake, [today]: (waterIntake[today] || 0) + ml };
                setWaterIntake(newIntake);
                saveData({ waterIntake: newIntake });
                syncToSheets({
                    action: 'log_water',
                    date: new Date().toISOString(),
                    ml: ml,
                    total: newIntake[today]
                });
            }, [waterIntake, saveData, syncToSheets]);

            // √öLTIMA MEDICI√ìN - NUEVO
            const getLatestMeasurement = useCallback(() => {
                if (measurements.length === 0) return null;
                return measurements[measurements.length - 1];
            }, [measurements]);

            // CALCULAR OBJETIVOS - NUEVO
            const calculateDerivedGoals = useCallback((weight, fatPercent, musclePercent) => {
                return {
                    fatKg: Math.round(weight * fatPercent / 100 * 10) / 10,
                    muscleKg: Math.round(weight * musclePercent / 100 * 10) / 10
                };
            }, []);

            // CARGAR ALIMENTOS CUSTOM - V4
            const loadCustomFoods = useCallback(async () => {
                try {
                    console.log('üì• Cargando alimentos custom...');
                    const response = await fetch(SHEETS_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({ action: 'get_custom_foods' })
                    });
                    const data = await response.json();
                    console.log('üì¶ Custom foods recibidos:', Object.keys(data || {}).length);
                    
                    if (data && typeof data === 'object') {
                        setCustomFoods(data);
                        saveData({ customFoods: data });
                    }
                } catch (error) {
                    console.error('‚ùå Error loading custom foods:', error);
                }
            }, []);

            // GUARDAR ALIMENTO CUSTOM - V4
            const saveCustomFood = useCallback(async (food, macros) => {
                console.log('üíæ Guardando alimento custom:', food);
                const newCustomFoods = { ...customFoods, [food.toLowerCase()]: macros };
                setCustomFoods(newCustomFoods);
                saveData({ customFoods: newCustomFoods });
                
                await syncToSheets({
                    action: 'save_custom_food',
                    food: food,
                    kcal: macros.kcal,
                    protein: macros.protein,
                    carbs: macros.carbs,
                    fat: macros.fat
                });
                
                console.log('‚úÖ Alimento guardado:', food);
            }, [customFoods, saveData, syncToSheets]);

            // CALCULAR MACROS CON CUSTOM FOODS - V4
            const calculateFoodMacrosV4 = useCallback((foodName, grams) => {
                const normalized = foodName.toLowerCase().trim();
                
                // Primero buscar en custom foods
                if (customFoods[normalized]) {
                    const food = customFoods[normalized];
                    const multiplier = grams / 100;
                    return {
                        kcal: Math.round(food.kcal * multiplier),
                        protein: Math.round(food.protein * multiplier * 10) / 10,
                        carbs: Math.round(food.carbs * multiplier * 10) / 10,
                        fat: Math.round(food.fat * multiplier * 10) / 10
                    };
                }
                
                // Sino buscar en base de datos est√°tica
                const food = FOOD_DATABASE[normalized];
                if (food) {
                    const multiplier = grams / 100;
                    return {
                        kcal: Math.round(food.kcal * multiplier),
                        protein: Math.round(food.protein * multiplier * 10) / 10,
                        carbs: Math.round(food.carbs * multiplier * 10) / 10,
                        fat: Math.round(food.fat * multiplier * 10) / 10
                    };
                }
                return null;
            }, [customFoods]);

            // CARGAR NOTAS DE COACHING - V4
            const loadCoachingNotes = useCallback(async () => {
                try {
                    console.log('üì• Cargando notas del coach...');
                    const response = await fetch(SHEET_URL.replace('/edit', '/gviz/tq?tqx=out:json&sheet=Coaching_Notes'));
                    const text = await response.text();
                    
                    // Parsear respuesta de Google Sheets
                    const jsonString = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
                    const data = JSON.parse(jsonString);
                    
                    if (data.table && data.table.rows) {
                        const notes = data.table.rows.map(row => ({
                            date: row.c[1]?.v || '',
                            week: row.c[2]?.v || 0,
                            type: row.c[3]?.v || 'consejo',
                            note: row.c[4]?.v || '',
                            context: row.c[5]?.v || ''
                        })).filter(note => note.note);
                        
                        console.log('üìù Notas cargadas:', notes.length);
                        setCoachingNotes(notes);
                    }
                } catch (error) {
                    console.log('‚ÑπÔ∏è No se pudieron cargar notas (puede ser normal si no hay notas a√∫n)');
                }
            }, []);

            // OBTENER ACTIVIDADES DE UN D√çA - V4
            const getDayActivities = useCallback((date) => {
                const dateStr = date.toDateString();
                
                return {
                    workouts: workoutHistory.filter(w => new Date(w.date).toDateString() === dateStr),
                    running: runningActivities.filter(r => new Date(r.date).toDateString() === dateStr),
                    football: footballActivities.filter(f => new Date(f.date).toDateString() === dateStr),
                    meals: meals.filter(m => new Date(m.date).toDateString() === dateStr),
                    water: waterIntake[dateStr] || 0,
                    wellness: wellness[dateStr] || null
                };
            }, [workoutHistory, runningActivities, footballActivities, meals, waterIntake, wellness]);


            if (loading) {
                return (
                    <div id="loader">
                        <i className="fas fa-dumbbell fa-spin fa-3x text-blue-500 mb-4"></i>
                        <p className="text-slate-500 font-bold uppercase tracking-widest text-xs">Cargando...</p>
                    </div>
                );
            }

            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950">
                        <div className="w-full max-w-sm fade-in">
                            <div className="text-center mb-8">
                                <div className="w-20 h-20 bg-blue-600/20 rounded-3xl mx-auto flex items-center justify-center mb-6 border border-blue-500/30 shadow-xl shadow-blue-500/10">
                                    <i className="fas fa-dumbbell text-blue-500 text-3xl"></i>
                                </div>
                                <h1 className="text-3xl font-black italic uppercase tracking-tighter mb-2">Entreno Pablo</h1>
                                <p className="text-slate-500 text-xs uppercase font-bold tracking-widest">Powerbuilding 6 Meses</p>
                            </div>
                            <form onSubmit={(e) => {
                                e.preventDefault();
                                if (loginForm.username.toLowerCase() === 'pablobernardo' && loginForm.password === 'timon') {
                                    setIsLoggedIn(true);
                                    localStorage.setItem('pablo_session', 'active');
                                    setLoginError('');
                                } else {
                                    setLoginError('Credenciales incorrectas');
                                }
                            }} className="space-y-4">
                                <input 
                                    type="text" 
                                    placeholder="Usuario" 
                                    value={loginForm.username}
                                    className="w-full bg-slate-950 border border-slate-800 p-4 rounded-xl outline-none focus:border-blue-500 text-white transition-colors" 
                                    onChange={e => setLoginForm({...loginForm, username: e.target.value})} 
                                />
                                <input 
                                    type="password" 
                                    placeholder="Contrase√±a"
                                    value={loginForm.password}
                                    className="w-full bg-slate-950 border border-slate-800 p-4 rounded-xl outline-none focus:border-blue-500 text-white transition-colors" 
                                    onChange={e => setLoginForm({...loginForm, password: e.target.value})} 
                                />
                                {loginError && <p className="text-red-500 text-xs font-bold text-center animate-pulse">{loginError}</p>}
                                <button className="w-full bg-gradient-to-r from-blue-600 to-blue-500 p-4 rounded-xl font-black uppercase italic tracking-widest active:scale-95 transition-all shadow-lg shadow-blue-600/20">
                                    Entrar
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            const routine = [
                { id: 'Lunes', title: 'Lunes: Pierna Fuerte', ex: [
                    { name: 'Sentadilla', w: initialWeights.sentadilla + stats.increment, s: stats.sets, r: stats.reps, wu: true, type: 'fuerte' },
                    { name: 'Pecho Plano', w: initialWeights.pecho + stats.increment, s: stats.sets, r: stats.reps, wu: true, type: 'fuerte' },
                    { name: 'Peso Muerto (T)', w: initialWeights.muerto + stats.increment, s: 3, r: 5, wu: false, type: 'tranquilo' }
                ]},
                { id: 'Miercoles', title: 'Mi√©rcoles: Pecho Fuerte', ex: [
                    { name: 'Pecho Plano', w: initialWeights.pecho + stats.increment, s: stats.sets, r: stats.reps, wu: true, type: 'fuerte' },
                    { name: 'Sentadilla (T)', w: initialWeights.sentadilla + stats.increment, s: 3, r: 5, wu: false, type: 'tranquilo' },
                    { name: 'Remo Barra', w: 'Moderado', s: 4, r: 10, wu: false, type: 'accesorio' }
                ]},
                { id: 'Viernes', title: 'Viernes: Muerto Fuerte', ex: [
                    { name: 'Peso Muerto', w: initialWeights.muerto + stats.increment, s: stats.sets, r: stats.reps, wu: true, type: 'fuerte' },
                    { name: 'Sentadilla (T)', w: initialWeights.sentadilla + stats.increment, s: 3, r: 5, wu: false, type: 'tranquilo' },
                    { name: 'Pecho (T)', w: Math.round((initialWeights.pecho + stats.increment) * 0.8), s: 3, r: 5, wu: false, type: 'tranquilo' }
                ]}
            ];

            // MODALES - RUNNING (de v2, mantenido)
            const RunningModal = () => {
                const [formData, setFormData] = useState({ km: '', kcal: '' });
                
                return (
                    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => setShowRunningModal(false)}>
                        <div className="bg-slate-900 rounded-3xl p-6 max-w-sm w-full border border-slate-800 modal-overlay" onClick={e => e.stopPropagation()}>
                            <h3 className="text-xl font-black uppercase italic mb-4 text-emerald-400">üèÉ Agregar Running</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">Kil√≥metros</label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        value={formData.km}
                                        onChange={e => setFormData({...formData, km: e.target.value})}
                                        className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-emerald-500"
                                        placeholder="5.5"
                                    />
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">Calor√≠as consumidas</label>
                                    <input
                                        type="number"
                                        value={formData.kcal}
                                        onChange={e => setFormData({...formData, kcal: e.target.value})}
                                        className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-emerald-500"
                                        placeholder="350"
                                    />
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setShowRunningModal(false)}
                                        className="flex-1 bg-slate-950 border border-slate-800 text-slate-400 p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={() => {
                                            if (formData.km && formData.kcal) {
                                                const newActivity = {
                                                    date: new Date().toISOString(),
                                                    km: parseFloat(formData.km),
                                                    kcal: parseInt(formData.kcal)
                                                };
                                                const newActivities = [...runningActivities, newActivity];
                                                setRunningActivities(newActivities);
                                                saveData({ runningActivities: newActivities });
                                                syncToSheets({
                                                    action: 'log_running',
                                                    ...newActivity
                                                });
                                                setShowRunningModal(false);
                                            }
                                        }}
                                        className="flex-1 bg-emerald-600 text-white p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Guardar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // MODAL F√öTBOL (de v2, mantenido)
            const FootballModal = () => {
                const [formData, setFormData] = useState({ type: '7', duration: '60', intensity: 'media' });
                
                return (
                    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => setShowFootballModal(false)}>
                        <div className="bg-slate-900 rounded-3xl p-6 max-w-sm w-full border border-slate-800 modal-overlay" onClick={e => e.stopPropagation()}>
                            <h3 className="text-xl font-black uppercase italic mb-4 text-orange-400">‚öΩ Agregar F√∫tbol</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-2">Tipo de cancha</label>
                                    <div className="flex gap-2">
                                        {['7', '9', '11'].map(type => (
                                            <button
                                                key={type}
                                                onClick={() => setFormData({...formData, type})}
                                                className={`flex-1 py-3 rounded-lg font-bold text-sm transition-all ${
                                                    formData.type === type 
                                                        ? 'bg-orange-600 text-white' 
                                                        : 'bg-slate-950 text-slate-500 border border-slate-800'
                                                }`}
                                            >
                                                {type}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">Duraci√≥n (minutos)</label>
                                    <input
                                        type="number"
                                        value={formData.duration}
                                        onChange={e => setFormData({...formData, duration: e.target.value})}
                                        className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-orange-500"
                                    />
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-2">Intensidad</label>
                                    <div className="flex gap-2">
                                        {['baja', 'media', 'alta'].map(intensity => (
                                            <button
                                                key={intensity}
                                                onClick={() => setFormData({...formData, intensity})}
                                                className={`flex-1 py-2 rounded-lg font-bold text-xs transition-all ${
                                                    formData.intensity === intensity 
                                                        ? 'bg-orange-600 text-white' 
                                                        : 'bg-slate-950 text-slate-500 border border-slate-800'
                                                }`}
                                            >
                                                {intensity.charAt(0).toUpperCase() + intensity.slice(1)}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setShowFootballModal(false)}
                                        className="flex-1 bg-slate-950 border border-slate-800 text-slate-400 p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={() => {
                                            const newActivity = {
                                                date: new Date().toISOString(),
                                                type: formData.type,
                                                duration: parseInt(formData.duration),
                                                intensity: formData.intensity
                                            };
                                            const newActivities = [...footballActivities, newActivity];
                                            setFootballActivities(newActivities);
                                            saveData({ footballActivities: newActivities });
                                            syncToSheets({
                                                action: 'log_football',
                                                ...newActivity
                                            });
                                            setShowFootballModal(false);
                                        }}
                                        className="flex-1 bg-orange-600 text-white p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Guardar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // MODAL COMIDA - NUEVO
            const MealModal = () => {
                const [formData, setFormData] = useState({ 
                    food: '', 
                    grams: '', 
                    autoCalc: true,
                    kcal: '',
                    protein: '',
                    carbs: '',
                    fat: ''
                });
                
                return (
                    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => setShowMealModal(false)}>
                        <div className="bg-slate-900 rounded-3xl p-6 max-w-sm w-full border border-slate-800 modal-overlay" onClick={e => e.stopPropagation()}>
                            <h3 className="text-xl font-black uppercase italic mb-4 text-purple-400">üçΩÔ∏è Agregar Comida</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">Alimento</label>
                                    <input
                                        type="text"
                                        value={formData.food}
                                        onChange={e => setFormData({...formData, food: e.target.value})}
                                        className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-purple-500"
                                        placeholder="ej: pollo, arroz, banana"
                                    />
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">Cantidad (gramos)</label>
                                    <input
                                        type="number"
                                        value={formData.grams}
                                        onChange={e => setFormData({...formData, grams: e.target.value})}
                                        className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-purple-500"
                                        placeholder="150"
                                    />
                                </div>
                                
                                <div className="flex items-center gap-2 p-3 bg-slate-950 rounded-lg">
                                    <input 
                                        type="checkbox" 
                                        checked={formData.autoCalc}
                                        onChange={e => setFormData({...formData, autoCalc: e.target.checked})}
                                        className="w-4 h-4"
                                    />
                                    <label className="text-xs text-slate-400 font-bold">Calcular autom√°tico</label>
                                </div>

                                {!formData.autoCalc && (
                                    <div className="grid grid-cols-2 gap-2">
                                        <div>
                                            <label className="text-xs text-slate-500 font-bold block mb-1">Kcal</label>
                                            <input
                                                type="number"
                                                value={formData.kcal}
                                                onChange={e => setFormData({...formData, kcal: e.target.value})}
                                                className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-purple-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-xs text-slate-500 font-bold block mb-1">Prote√≠na (g)</label>
                                            <input
                                                type="number"
                                                value={formData.protein}
                                                onChange={e => setFormData({...formData, protein: e.target.value})}
                                                className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-purple-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-xs text-slate-500 font-bold block mb-1">Carbos (g)</label>
                                            <input
                                                type="number"
                                                value={formData.carbs}
                                                onChange={e => setFormData({...formData, carbs: e.target.value})}
                                                className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-purple-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-xs text-slate-500 font-bold block mb-1">Grasas (g)</label>
                                            <input
                                                type="number"
                                                value={formData.fat}
                                                onChange={e => setFormData({...formData, fat: e.target.value})}
                                                className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-purple-500"
                                            />
                                        </div>
                                    </div>
                                )}
                                
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setShowMealModal(false)}
                                        className="flex-1 bg-slate-950 border border-slate-800 text-slate-400 p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={async () => {
                                            if (formData.food && formData.grams) {
                                                let macros;
                                                if (formData.autoCalc) {
                                                    macros = calculateFoodMacrosV4(formData.food, parseFloat(formData.grams));
                                                    if (!macros) {
                                                        alert('Alimento no encontrado. Ingres√° los valores manualmente.');
                                                        return;
                                                    }
                                                } else {
                                                    macros = {
                                                        kcal: parseInt(formData.kcal) || 0,
                                                        protein: parseFloat(formData.protein) || 0,
                                                        carbs: parseFloat(formData.carbs) || 0,
                                                        fat: parseFloat(formData.fat) || 0
                                                    };
                                                    // Guardar en custom foods para futuro uso
                                                    saveCustomFood(formData.food, macros);
                                                }
                                                
                                                const newMeal = {
                                                    date: new Date().toISOString(),
                                                    food: formData.food,
                                                    grams: parseFloat(formData.grams),
                                                    ...macros
                                                };
                                                
                                                console.log('üçΩÔ∏è Guardando comida:', newMeal);
                                                
                                                const newMeals = [...meals, newMeal];
                                                setMeals(newMeals);
                                                saveData({ meals: newMeals });
                                                
                                                const syncResult = await syncToSheets({
                                                    action: 'log_meal',
                                                    ...newMeal
                                                });
                                                
                                                console.log(syncResult ? '‚úÖ Comida guardada en Sheet' : '‚ùå Error guardando en Sheet');
                                                setShowMealModal(false);
                                            }
                                        }}
                                        className="flex-1 bg-purple-600 text-white p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Guardar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // MODAL MEDICIONES - NUEVO
            const MeasurementModal = () => {
                const [formData, setFormData] = useState({ 
                    weight: '', 
                    waist: '', 
                    chest: '',
                    arms: '',
                    legs: ''
                });
                
                return (
                    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => setShowMeasurementModal(false)}>
                        <div className="bg-slate-900 rounded-3xl p-6 max-w-sm w-full border border-slate-800 modal-overlay" onClick={e => e.stopPropagation()}>
                            <h3 className="text-xl font-black uppercase italic mb-4 text-blue-400">üìè Nueva Medici√≥n</h3>
                            <div className="space-y-3">
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">Peso (kg)</label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        value={formData.weight}
                                        onChange={e => setFormData({...formData, weight: e.target.value})}
                                        className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-blue-500"
                                    />
                                </div>
                                <div className="grid grid-cols-2 gap-2">
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Cintura (cm)</label>
                                        <input
                                            type="number"
                                            value={formData.waist}
                                            onChange={e => setFormData({...formData, waist: e.target.value})}
                                            className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-blue-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Pecho (cm)</label>
                                        <input
                                            type="number"
                                            value={formData.chest}
                                            onChange={e => setFormData({...formData, chest: e.target.value})}
                                            className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-blue-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Brazos (cm)</label>
                                        <input
                                            type="number"
                                            value={formData.arms}
                                            onChange={e => setFormData({...formData, arms: e.target.value})}
                                            className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-blue-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Piernas (cm)</label>
                                        <input
                                            type="number"
                                            value={formData.legs}
                                            onChange={e => setFormData({...formData, legs: e.target.value})}
                                            className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-blue-500"
                                        />
                                    </div>
                                </div>
                                <div className="flex gap-2 pt-2">
                                    <button
                                        onClick={() => setShowMeasurementModal(false)}
                                        className="flex-1 bg-slate-950 border border-slate-800 text-slate-400 p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={() => {
                                            if (formData.weight) {
                                                const newMeasurement = {
                                                    date: new Date().toISOString(),
                                                    weight: parseFloat(formData.weight),
                                                    waist: parseFloat(formData.waist) || 0,
                                                    chest: parseFloat(formData.chest) || 0,
                                                    arms: parseFloat(formData.arms) || 0,
                                                    legs: parseFloat(formData.legs) || 0
                                                };
                                                const newMeasurements = [...measurements, newMeasurement];
                                                setMeasurements(newMeasurements);
                                                saveData({ measurements: newMeasurements });
                                                syncToSheets({
                                                    action: 'log_measurement',
                                                    ...newMeasurement
                                                });
                                                setShowMeasurementModal(false);
                                            }
                                        }}
                                        className="flex-1 bg-blue-600 text-white p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Guardar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // MODAL BIENESTAR - NUEVO
            const WellnessModal = () => {
                const [formData, setFormData] = useState({ 
                    sleep: '', 
                    quality: 3,
                    notes: ''
                });
                
                return (
                    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => setShowWellnessModal(false)}>
                        <div className="bg-slate-900 rounded-3xl p-6 max-w-sm w-full border border-slate-800 modal-overlay" onClick={e => e.stopPropagation()}>
                            <h3 className="text-xl font-black uppercase italic mb-4 text-cyan-400">üò¥ Bienestar Hoy</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">Horas de sue√±o</label>
                                    <input
                                        type="number"
                                        step="0.5"
                                        value={formData.sleep}
                                        onChange={e => setFormData({...formData, sleep: e.target.value})}
                                        className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-cyan-500"
                                        placeholder="7.5"
                                    />
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-2">Calidad del sue√±o</label>
                                    <div className="flex justify-center gap-2">
                                        {[1,2,3,4,5].map(star => (
                                            <button
                                                key={star}
                                                onClick={() => setFormData({...formData, quality: star})}
                                                className="text-3xl active:scale-95 transition-all"
                                            >
                                                {star <= formData.quality ? '‚≠ê' : '‚òÜ'}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">Notas / Sensaciones</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={e => setFormData({...formData, notes: e.target.value})}
                                        className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-cyan-500 h-20 resize-none"
                                        placeholder="¬øC√≥mo te sent√≠s hoy?"
                                    />
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setShowWellnessModal(false)}
                                        className="flex-1 bg-slate-950 border border-slate-800 text-slate-400 p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={() => {
                                            const today = new Date().toDateString();
                                            const newWellness = {
                                                ...wellness,
                                                [today]: {
                                                    date: new Date().toISOString(),
                                                    sleep: parseFloat(formData.sleep) || 0,
                                                    quality: formData.quality,
                                                    notes: formData.notes
                                                }
                                            };
                                            setWellness(newWellness);
                                            saveData({ wellness: newWellness });
                                            syncToSheets({
                                                action: 'log_wellness',
                                                ...newWellness[today]
                                            });
                                            setShowWellnessModal(false);
                                        }}
                                        className="flex-1 bg-cyan-600 text-white p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                    >
                                        Guardar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // VISTA NUTRICI√ìN - NUEVA COMPLETA
            const NutritionView = () => {
                const dailyNutrition = getDailyNutrition();
                const todayWater = getTodayWater();
                const latestMeasurement = getLatestMeasurement();
                const today = new Date().toDateString();
                const todayWellness = wellness[today];
                
                return (
                    <div className="max-w-md mx-auto min-h-screen pb-24 fade-in p-4 no-scrollbar overflow-y-auto">
                        <h2 className="text-2xl font-black uppercase italic mb-6 border-l-4 border-purple-500 pl-3">Nutrici√≥n</h2>
                        
                        {/* MACROS DEL D√çA */}
                        <div className="bg-gradient-to-br from-purple-900/20 to-purple-950/20 p-5 rounded-3xl border border-purple-800/50 mb-4">
                            <h3 className="text-sm font-black uppercase text-purple-400 mb-3">üçΩÔ∏è Hoy</h3>
                            <div className="grid grid-cols-4 gap-2 mb-3">
                                <div className="bg-slate-950/50 p-2 rounded-xl text-center">
                                    <p className="text-lg font-black text-white">{Math.round(dailyNutrition.kcal)}</p>
                                    <p className="text-[8px] text-slate-500 font-bold uppercase">Kcal</p>
                                </div>
                                <div className="bg-slate-950/50 p-2 rounded-xl text-center">
                                    <p className="text-lg font-black text-red-400">{Math.round(dailyNutrition.protein)}g</p>
                                    <p className="text-[8px] text-slate-500 font-bold uppercase">Prot</p>
                                </div>
                                <div className="bg-slate-950/50 p-2 rounded-xl text-center">
                                    <p className="text-lg font-black text-blue-400">{Math.round(dailyNutrition.carbs)}g</p>
                                    <p className="text-[8px] text-slate-500 font-bold uppercase">Carbs</p>
                                </div>
                                <div className="bg-slate-950/50 p-2 rounded-xl text-center">
                                    <p className="text-lg font-black text-yellow-400">{Math.round(dailyNutrition.fat)}g</p>
                                    <p className="text-[8px] text-slate-500 font-bold uppercase">Grasas</p>
                                </div>
                            </div>
                            <button
                                onClick={() => setShowMealModal(true)}
                                className="w-full bg-purple-600 text-white p-3 rounded-xl font-bold text-sm active:scale-95 transition-all"
                            >
                                + Agregar Comida
                            </button>
                        </div>

                        {/* ACTIVIDAD F√çSICA */}
                        <div className="bg-gradient-to-br from-emerald-900/20 to-orange-900/20 p-5 rounded-3xl border border-emerald-800/50 mb-4">
                            <h3 className="text-sm font-black uppercase text-emerald-400 mb-3">üèÉ Actividad F√≠sica</h3>
                            
                            <div className="grid grid-cols-2 gap-2 mb-3">
                                <button
                                    onClick={() => setShowRunningModal(true)}
                                    className="bg-emerald-900/30 border border-emerald-800 text-emerald-400 p-3 rounded-xl font-bold text-sm active:scale-95 transition-all"
                                >
                                    üèÉ Running
                                </button>
                                <button
                                    onClick={() => setShowFootballModal(true)}
                                    className="bg-orange-900/30 border border-orange-800 text-orange-400 p-3 rounded-xl font-bold text-sm active:scale-95 transition-all"
                                >
                                    ‚öΩ F√∫tbol
                                </button>
                            </div>
                            
                            {/* √öltimas actividades */}
                            {(runningActivities.length > 0 || footballActivities.length > 0) && (
                                <div className="space-y-2">
                                    <p className="text-xs text-slate-500 font-bold uppercase mb-2">√öltimas actividades</p>
                                    {[...runningActivities.slice(-3).reverse(), ...footballActivities.slice(-3).reverse()]
                                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                                        .slice(0, 3)
                                        .map((act, i) => (
                                            <div key={i} className="bg-slate-950/50 p-2 rounded-lg flex justify-between items-center text-xs">
                                                <span className="text-slate-400">
                                                    {act.km ? ('üèÉ ' + act.km + 'km') : ('‚öΩ ' + act.type + ' (' + act.duration + 'min)')}
                                                </span>
                                                <span className="text-emerald-400 font-bold">
                                                    {act.kcal || 0} kcal
                                                </span>
                                            </div>
                                        ))
                                    }
                                </div>
                            )}
                        </div>

                        {/* HIDRATACI√ìN */}
                        <div className="bg-gradient-to-br from-cyan-900/20 to-cyan-950/20 p-5 rounded-3xl border border-cyan-800/50 mb-4">
                            <h3 className="text-sm font-black uppercase text-cyan-400 mb-3">üíß Hidrataci√≥n</h3>
                            <div className="flex items-end justify-between mb-3">
                                <div>
                                    <p className="text-3xl font-black text-white">{todayWater}ml</p>
                                    <p className="text-xs text-slate-500">de {waterGoal}ml</p>
                                </div>
                                <div className="text-right">
                                    <p className="text-lg font-bold text-cyan-400">{Math.round(todayWater/waterGoal*100)}%</p>
                                </div>
                            </div>
                            <div className="w-full h-2 bg-slate-950 rounded-full overflow-hidden mb-3">
                                <div 
                                    className="h-full bg-gradient-to-r from-cyan-600 to-cyan-400 transition-all duration-500"
                                    style={{width: `${Math.min(todayWater/waterGoal*100, 100)}%`}}
                                ></div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => addWater(250)} className="flex-1 bg-cyan-900/30 border border-cyan-800 text-cyan-400 py-2 rounded-lg font-bold text-xs active:scale-95 transition-all">
                                    +250ml
                                </button>
                                <button onClick={() => addWater(500)} className="flex-1 bg-cyan-900/30 border border-cyan-800 text-cyan-400 py-2 rounded-lg font-bold text-xs active:scale-95 transition-all">
                                    +500ml
                                </button>
                                <button onClick={() => addWater(1000)} className="flex-1 bg-cyan-900/30 border border-cyan-800 text-cyan-400 py-2 rounded-lg font-bold text-xs active:scale-95 transition-all">
                                    +1L
                                </button>
                            </div>
                        </div>

                        {/* BIENESTAR */}
                        <div className="bg-gradient-to-br from-indigo-900/20 to-indigo-950/20 p-5 rounded-3xl border border-indigo-800/50 mb-4">
                            <h3 className="text-sm font-black uppercase text-indigo-400 mb-3">üò¥ Bienestar</h3>
                            {todayWellness ? (
                                <div className="space-y-2">
                                    <div className="flex justify-between items-center">
                                        <span className="text-xs text-slate-400">Sue√±o:</span>
                                        <span className="text-sm font-bold text-white">{todayWellness.sleep}h</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-xs text-slate-400">Calidad:</span>
                                        <span className="text-sm">{'‚≠ê'.repeat(todayWellness.quality)}</span>
                                    </div>
                                    {todayWellness.notes && (
                                        <p className="text-xs text-slate-400 italic mt-2">"{todayWellness.notes}"</p>
                                    )}
                                </div>
                            ) : (
                                <p className="text-xs text-slate-500 mb-3">No hay registro de hoy</p>
                            )}
                            <button
                                onClick={() => setShowWellnessModal(true)}
                                className="w-full bg-indigo-600 text-white p-2 rounded-lg font-bold text-xs active:scale-95 transition-all mt-3"
                            >
                                {todayWellness ? 'Actualizar' : 'Registrar Hoy'}
                            </button>
                        </div>

                        {/* OBJETIVOS CORPORALES */}
                        <div className="bg-gradient-to-br from-blue-900/20 to-blue-950/20 p-5 rounded-3xl border border-blue-800/50 mb-4">
                            <h3 className="text-sm font-black uppercase text-blue-400 mb-3">üéØ Objetivos</h3>
                            
                            {latestMeasurement && (
                                <div className="mb-4 p-3 bg-slate-950/50 rounded-xl">
                                    <p className="text-xs text-slate-500 mb-2">√öltima medici√≥n: {new Date(latestMeasurement.date).toLocaleDateString('es-AR')}</p>
                                    <p className="text-2xl font-black text-white">{latestMeasurement.weight} kg</p>
                                </div>
                            )}
                            
                            <div className="space-y-3">
                                <div className="grid grid-cols-2 gap-2">
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Peso Objetivo (kg)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={bodyGoals.weightGoal || ''}
                                            onChange={e => {
                                                const newGoals = {...bodyGoals, weightGoal: parseFloat(e.target.value) || 0};
                                                setBodyGoals(newGoals);
                                                saveData({bodyGoals: newGoals});
                                            }}
                                            className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-blue-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">% Grasa Objetivo</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={bodyGoals.fatPercentGoal || ''}
                                            onChange={e => {
                                                const newGoals = {...bodyGoals, fatPercentGoal: parseFloat(e.target.value) || 0};
                                                setBodyGoals(newGoals);
                                                saveData({bodyGoals: newGoals});
                                            }}
                                            className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-blue-500"
                                        />
                                    </div>
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 font-bold block mb-1">% M√∫sculo Objetivo</label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        value={bodyGoals.musclePercentGoal || ''}
                                        onChange={e => {
                                            const newGoals = {...bodyGoals, musclePercentGoal: parseFloat(e.target.value) || 0};
                                            setBodyGoals(newGoals);
                                            saveData({bodyGoals: newGoals});
                                        }}
                                        className="w-full bg-slate-950 border border-slate-800 p-2 rounded-lg text-white text-sm outline-none focus:border-blue-500"
                                    />
                                </div>
                                
                                {bodyGoals.weightGoal > 0 && bodyGoals.fatPercentGoal > 0 && bodyGoals.musclePercentGoal > 0 && (
                                    <div className="grid grid-cols-2 gap-2 mt-3">
                                        <div className="bg-red-900/20 p-2 rounded-lg text-center border border-red-800/30">
                                            <p className="text-xs text-slate-500 mb-1">Grasa</p>
                                            <p className="text-lg font-black text-red-400">
                                                {calculateDerivedGoals(bodyGoals.weightGoal, bodyGoals.fatPercentGoal, 0).fatKg} kg
                                            </p>
                                        </div>
                                        <div className="bg-emerald-900/20 p-2 rounded-lg text-center border border-emerald-800/30">
                                            <p className="text-xs text-slate-500 mb-1">M√∫sculo</p>
                                            <p className="text-lg font-black text-emerald-400">
                                                {calculateDerivedGoals(bodyGoals.weightGoal, 0, bodyGoals.musclePercentGoal).muscleKg} kg
                                            </p>
                                        </div>
                                    </div>
                                )}
                                
                                <button
                                    onClick={() => {
                                        if (bodyGoals.weightGoal > 0) {
                                            syncToSheets({
                                                action: 'update_goals',
                                                ...bodyGoals,
                                                ...calculateDerivedGoals(bodyGoals.weightGoal, bodyGoals.fatPercentGoal, bodyGoals.musclePercentGoal)
                                            });
                                        }
                                    }}
                                    className="w-full bg-blue-600 text-white p-2 rounded-lg font-bold text-xs active:scale-95 transition-all"
                                >
                                    Guardar Objetivos
                                </button>
                            </div>
                        </div>

                        {/* MEDICIONES */}
                        <div className="bg-gradient-to-br from-yellow-900/20 to-yellow-950/20 p-5 rounded-3xl border border-yellow-800/50 mb-4">
                            <h3 className="text-sm font-black uppercase text-yellow-400 mb-3">üìè Mediciones</h3>
                            <button
                                onClick={() => setShowMeasurementModal(true)}
                                className="w-full bg-yellow-600 text-white p-3 rounded-xl font-bold text-sm active:scale-95 transition-all mb-3"
                            >
                                + Nueva Medici√≥n
                            </button>
                            
                            {measurements.length > 0 && (
                                <div className="space-y-2">
                                    {measurements.slice(-3).reverse().map((m, i) => (
                                        <div key={i} className="bg-slate-950/50 p-3 rounded-xl">
                                            <div className="flex justify-between items-center mb-2">
                                                <p className="text-xs text-slate-500">{new Date(m.date).toLocaleDateString('es-AR')}</p>
                                                <p className="text-lg font-black text-white">{m.weight} kg</p>
                                            </div>
                                            {(m.waist > 0 || m.chest > 0) && (
                                                <div className="grid grid-cols-4 gap-1 text-xs">
                                                    {m.waist > 0 && <div><span className="text-slate-600">Cin:</span> <span className="text-slate-400">{m.waist}cm</span></div>}
                                                    {m.chest > 0 && <div><span className="text-slate-600">Pec:</span> <span className="text-slate-400">{m.chest}cm</span></div>}
                                                    {m.arms > 0 && <div><span className="text-slate-600">Bra:</span> <span className="text-slate-400">{m.arms}cm</span></div>}
                                                    {m.legs > 0 && <div><span className="text-slate-600">Pie:</span> <span className="text-slate-400">{m.legs}cm</span></div>}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* COMIDAS DEL D√çA */}
                        {meals.filter(m => new Date(m.date).toDateString() === today).length > 0 && (
                            <div>
                                <h3 className="text-sm font-black uppercase text-slate-400 mb-3">Comidas de Hoy</h3>
                                <div className="space-y-2">
                                    {meals.filter(m => new Date(m.date).toDateString() === today).map((meal, i) => (
                                        <div key={i} className="bg-slate-900 p-3 rounded-xl border border-slate-800">
                                            <div className="flex justify-between items-start mb-1">
                                                <div>
                                                    <p className="text-sm font-bold text-white capitalize">{meal.food}</p>
                                                    <p className="text-xs text-slate-500">{meal.grams}g</p>
                                                </div>
                                                <p className="text-sm font-bold text-purple-400">{meal.kcal} kcal</p>
                                            </div>
                                            <div className="flex gap-3 text-xs mt-2">
                                                <span className="text-red-400">P: {meal.protein}g</span>
                                                <span className="text-blue-400">C: {meal.carbs}g</span>
                                                <span className="text-yellow-400">G: {meal.fat}g</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            
            // VISTA CALENDARIO - V4
            const CalendarView = () => {
                const year = calendarView.getFullYear();
                const month = calendarView.getMonth();
                const today = new Date();
                
                // Obtener d√≠as del mes
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();
                
                // Crear array de d√≠as
                const days = [];
                for (let i = 0; i < startingDayOfWeek; i++) {
                    days.push(null);
                }
                for (let i = 1; i <= daysInMonth; i++) {
                    days.push(new Date(year, month, i));
                }
                
                const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                                   'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                
                const changeMonth = (delta) => {
                    const newDate = new Date(year, month + delta, 1);
                    setCalendarView(newDate);
                };
                
                const getDayIndicators = (date) => {
                    if (!date) return [];
                    const activities = getDayActivities(date);
                    const indicators = [];
                    
                    if (activities.workouts.length > 0) indicators.push({ icon: 'üèãÔ∏è', color: 'bg-blue-500' });
                    if (activities.running.length > 0) indicators.push({ icon: 'üèÉ', color: 'bg-emerald-500' });
                    if (activities.football.length > 0) indicators.push({ icon: '‚öΩ', color: 'bg-orange-500' });
                    if (activities.meals.length > 0) indicators.push({ icon: 'üçΩÔ∏è', color: 'bg-purple-500' });
                    if (activities.water >= waterGoal) indicators.push({ icon: 'üíß', color: 'bg-cyan-500' });
                    
                    return indicators;
                };
                
                return (
                    <div className="max-w-md mx-auto min-h-screen pb-24 fade-in p-4">
                        <div className="flex items-center justify-between mb-6">
                            <button
                                onClick={() => changeMonth(-1)}
                                className="p-3 bg-slate-900 rounded-xl border border-slate-800 active:scale-95 transition-all"
                            >
                                <i className="fas fa-chevron-left text-slate-400"></i>
                            </button>
                            <h2 className="text-2xl font-black uppercase italic">
                                {monthNames[month]} {year}
                            </h2>
                            <button
                                onClick={() => changeMonth(1)}
                                className="p-3 bg-slate-900 rounded-xl border border-slate-800 active:scale-95 transition-all"
                            >
                                <i className="fas fa-chevron-right text-slate-400"></i>
                            </button>
                        </div>
                        
                        {/* D√≠as de la semana */}
                        <div className="grid grid-cols-7 gap-1 mb-2">
                            {['D', 'L', 'M', 'M', 'J', 'V', 'S'].map((day, i) => (
                                <div key={i} className="text-center text-xs font-black text-slate-500 py-2">
                                    {day}
                                </div>
                            ))}
                        </div>
                        
                        {/* Grid de d√≠as */}
                        <div className="grid grid-cols-7 gap-1">
                            {days.map((date, index) => {
                                if (!date) {
                                    return <div key={index} className="aspect-square"></div>;
                                }
                                
                                const isToday = date.toDateString() === today.toDateString();
                                const indicators = getDayIndicators(date);
                                
                                return (
                                    <button
                                        key={index}
                                        onClick={() => {
                                            setSelectedDay(date);
                                            setShowDayModal(true);
                                        }}
                                        className={`aspect-square rounded-xl border-2 p-1 flex flex-col items-center justify-between active:scale-95 transition-all ${
                                            isToday 
                                                ? 'border-yellow-500 bg-yellow-500/20' 
                                                : indicators.length > 0
                                                    ? 'border-slate-700 bg-slate-900'
                                                    : 'border-slate-800 bg-slate-950'
                                        }`}
                                    >
                                        <span className={`text-xs font-bold ${isToday ? 'text-yellow-400' : 'text-slate-400'}`}>
                                            {date.getDate()}
                                        </span>
                                        <div className="flex gap-0.5 flex-wrap justify-center">
                                            {indicators.slice(0, 3).map((ind, i) => (
                                                <div key={i} className={`w-1.5 h-1.5 rounded-full ${ind.color}`}></div>
                                            ))}
                                        </div>
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            // MODAL D√çA - V4
            const DayModal = () => {
                if (!selectedDay) return null;
                const activities = getDayActivities(selectedDay);
                
                return (
                    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => setShowDayModal(false)}>
                        <div className="bg-slate-900 rounded-3xl p-6 max-w-sm w-full max-h-[80vh] overflow-y-auto border border-slate-800" onClick={e => e.stopPropagation()}>
                            <h3 className="text-xl font-black uppercase italic mb-4 text-blue-400">
                                üìÖ {selectedDay.toLocaleDateString('es-AR', { weekday: 'long', day: 'numeric', month: 'long' })}
                            </h3>
                            
                            {/* Entrenamientos */}
                            {activities.workouts.length > 0 && (
                                <div className="mb-4">
                                    <p className="text-xs font-black uppercase text-blue-400 mb-2">üèãÔ∏è Entreno</p>
                                    <div className="space-y-1">
                                        {activities.workouts.map((w, i) => (
                                            <p key={i} className="text-xs text-slate-400">‚Ä¢ {w.exercise}</p>
                                        ))}
                                    </div>
                                </div>
                            )}
                            
                            {/* Running */}
                            {activities.running.length > 0 && (
                                <div className="mb-4">
                                    <p className="text-xs font-black uppercase text-emerald-400 mb-2">üèÉ Running</p>
                                    {activities.running.map((r, i) => (
                                        <p key={i} className="text-xs text-slate-400">‚Ä¢ {r.km}km - {r.kcal} kcal</p>
                                    ))}
                                </div>
                            )}
                            
                            {/* F√∫tbol */}
                            {activities.football.length > 0 && (
                                <div className="mb-4">
                                    <p className="text-xs font-black uppercase text-orange-400 mb-2">‚öΩ F√∫tbol</p>
                                    {activities.football.map((f, i) => (
                                        <p key={i} className="text-xs text-slate-400">‚Ä¢ {f.type} ({f.duration}min)</p>
                                    ))}
                                </div>
                            )}
                            
                            {/* Comidas */}
                            {activities.meals.length > 0 && (
                                <div className="mb-4">
                                    <p className="text-xs font-black uppercase text-purple-400 mb-2">üçΩÔ∏è Comidas ({activities.meals.length})</p>
                                    <p className="text-xs text-slate-400">
                                        Total: {activities.meals.reduce((acc, m) => acc + m.kcal, 0)} kcal
                                    </p>
                                </div>
                            )}
                            
                            {/* Agua */}
                            {activities.water > 0 && (
                                <div className="mb-4">
                                    <p className="text-xs font-black uppercase text-cyan-400 mb-2">üíß Hidrataci√≥n</p>
                                    <p className="text-xs text-slate-400">{activities.water}ml de {waterGoal}ml</p>
                                </div>
                            )}
                            
                            {/* Bienestar */}
                            {activities.wellness && (
                                <div className="mb-4">
                                    <p className="text-xs font-black uppercase text-indigo-400 mb-2">üò¥ Bienestar</p>
                                    <p className="text-xs text-slate-400">Sue√±o: {activities.wellness.sleep}h - {'‚≠ê'.repeat(activities.wellness.quality)}</p>
                                </div>
                            )}
                            
                            {activities.workouts.length === 0 && activities.running.length === 0 && 
                             activities.football.length === 0 && activities.meals.length === 0 && (
                                <p className="text-sm text-slate-500 text-center py-8">No hay actividades registradas</p>
                            )}
                            
                            <button
                                onClick={() => setShowDayModal(false)}
                                className="w-full bg-blue-600 text-white p-3 rounded-xl font-bold text-sm active:scale-95 transition-all mt-4"
                            >
                                Cerrar
                            </button>
                        </div>
                    </div>
                );
            };

            // VISTA HISTORIAL (mantenida de v2)
            const HistoryView = () => {
                const groupedHistory = useMemo(() => {
                    const groups = {};
                    workoutHistory.forEach(entry => {
                        const date = new Date(entry.date).toLocaleDateString('es-AR');
                        if (!groups[date]) groups[date] = [];
                        groups[date].push(entry);
                    });
                    return Object.entries(groups).reverse().slice(0, 10);
                }, []);

                return (
                    <div className="max-w-md mx-auto min-h-screen pb-24 fade-in p-4">
                        <h2 className="text-2xl font-black uppercase italic mb-6 border-l-4 border-emerald-500 pl-3">Historial</h2>
                        {groupedHistory.length === 0 ? (
                            <div className="text-center py-12">
                                <i className="fas fa-clipboard-list text-slate-800 text-5xl mb-4"></i>
                                <p className="text-slate-600 font-bold">No hay entrenamientos registrados</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {groupedHistory.map(([date, entries]) => (
                                    <div key={date} className="bg-slate-900 p-4 rounded-2xl border border-slate-800">
                                        <p className="text-xs font-black text-emerald-400 mb-3 uppercase">{date}</p>
                                        <div className="space-y-2">
                                            {entries.map((entry, i) => (
                                                <div key={i} className="flex justify-between items-center text-sm">
                                                    <span className="text-slate-400">{entry.exercise}</span>
                                                    <span className="text-slate-600 font-bold text-xs">Sem {entry.week} ‚Ä¢ {entry.day}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                );
            };

            // VISTA CONFIGURACI√ìN (actualizada)
            const SettingsView = () => {
                return (
                    <div className="max-w-md mx-auto min-h-screen pb-24 fade-in p-4">
                        <h2 className="text-2xl font-black uppercase italic mb-6 border-l-4 border-blue-500 pl-3">Configuraci√≥n</h2>
                        
                        <div className="space-y-6">
                            {/* Google Sheets Sync */}
                            <div className="bg-gradient-to-br from-emerald-900/20 to-emerald-950/20 p-5 rounded-2xl border border-emerald-800/50">
                                <div className="flex items-center justify-between mb-4">
                                    <div className="flex items-center gap-3">
                                        <i className="fas fa-table text-emerald-400 text-xl"></i>
                                        <h3 className="text-sm font-black uppercase text-emerald-400">Google Sheets</h3>
                                    </div>
                                    {syncStatus === 'syncing' && <i className="fas fa-sync animate-spin text-blue-400"></i>}
                                    {syncStatus === 'success' && <i className="fas fa-check text-emerald-400"></i>}
                                    {syncStatus === 'error' && <i className="fas fa-exclamation-triangle text-red-400"></i>}
                                </div>
                                <p className="text-xs text-slate-400 mb-3">
                                    Sincronizado autom√°ticamente
                                </p>
                                {lastSync && (
                                    <p className="text-[10px] text-slate-600 mb-3">
                                        √öltima sync: {lastSync.toLocaleString('es-AR')}
                                    </p>
                                )}
                            
                                <a 
                                    href={SHEET_URL}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="w-full bg-emerald-600 text-white p-3 rounded-xl font-bold text-sm active:scale-95 transition-all flex items-center justify-center gap-2 mt-3"
                                >
                                    <i className="fas fa-external-link-alt"></i>
                                    Abrir en Google Sheets
                                </a>
                            </div>

                            {/* Notas del Coach - V4 */}
                            <div className="bg-gradient-to-br from-pink-900/20 to-pink-950/20 p-5 rounded-2xl border border-pink-800/50 mb-6">
                                <h3 className="text-sm font-black uppercase text-pink-400 mb-4">üìù Notas del Coach</h3>
                                {coachingNotes.length === 0 ? (
                                    <p className="text-xs text-slate-500 mb-3">
                                        Todav√≠a no hay notas. El coach va a escribir an√°lisis y recomendaciones ac√°.
                                    </p>
                                ) : (
                                    <div className="space-y-3">
                                        {coachingNotes.slice(-3).reverse().map((note, i) => (
                                            <div key={i} className="bg-slate-950/50 p-3 rounded-xl">
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-xs text-slate-500">{new Date(note.date).toLocaleDateString('es-AR')}</span>
                                                    <span className={`text-xs font-bold px-2 py-1 rounded ${
                                                        note.type === 'felicitaci√≥n' ? 'bg-emerald-900/30 text-emerald-400' :
                                                        note.type === 'alerta' ? 'bg-red-900/30 text-red-400' :
                                                        note.type === 'ajuste' ? 'bg-orange-900/30 text-orange-400' :
                                                        'bg-blue-900/30 text-blue-400'
                                                    }`}>
                                                        {note.type}
                                                    </span>
                                                </div>
                                                <p className="text-xs text-slate-300">{note.note}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <a 
                                    href={SHEET_URL}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="w-full bg-pink-900/30 border border-pink-800 text-pink-400 p-2 rounded-lg font-bold text-xs active:scale-95 transition-all flex items-center justify-center gap-2 mt-3"
                                >
                                    Ver todas las notas en Sheet
                                </a>
                            </div>

                                                        {/* Pesos Iniciales */}
                            <div className="bg-slate-900 p-5 rounded-2xl border border-slate-800">
                                <h3 className="text-sm font-black uppercase text-blue-400 mb-4">Pesos Base (kg)</h3>
                                <div className="space-y-3">
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Sentadilla</label>
                                        <input 
                                            type="number" 
                                            value={initialWeights.sentadilla}
                                            onChange={(e) => {
                                                const newWeights = {...initialWeights, sentadilla: parseInt(e.target.value) || 0};
                                                setInitialWeights(newWeights);
                                                saveData({initialWeights: newWeights});
                                            }}
                                            className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-blue-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Peso Muerto</label>
                                        <input 
                                            type="number" 
                                            value={initialWeights.muerto}
                                            onChange={(e) => {
                                                const newWeights = {...initialWeights, muerto: parseInt(e.target.value) || 0};
                                                setInitialWeights(newWeights);
                                                saveData({initialWeights: newWeights});
                                            }}
                                            className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-blue-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Pecho Plano</label>
                                        <input 
                                            type="number" 
                                            value={initialWeights.pecho}
                                            onChange={(e) => {
                                                const newWeights = {...initialWeights, pecho: parseInt(e.target.value) || 0};
                                                setInitialWeights(newWeights);
                                                saveData({initialWeights: newWeights});
                                            }}
                                            className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-blue-500"
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Timer + Meta Agua */}
                            <div className="bg-slate-900 p-5 rounded-2xl border border-slate-800">
                                <h3 className="text-sm font-black uppercase text-blue-400 mb-4">Configuraciones</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-2">Tiempo de Descanso</label>
                                        <div className="flex gap-2">
                                            {[120, 150, 180, 210, 240].map(seconds => (
                                                <button
                                                    key={seconds}
                                                    onClick={() => {
                                                        setTargetTime(seconds);
                                                        saveData({targetTime: seconds});
                                                    }}
                                                    className={`flex-1 py-2 rounded-lg font-bold text-xs transition-all ${
                                                        targetTime === seconds 
                                                            ? 'bg-blue-600 text-white' 
                                                            : 'bg-slate-950 text-slate-500 border border-slate-800'
                                                    }`}
                                                >
                                                    {Math.floor(seconds / 60)}:{(seconds % 60).toString().padStart(2, '0')}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-500 font-bold block mb-1">Meta de Agua Diaria (ml)</label>
                                        <input
                                            type="number"
                                            step="100"
                                            value={waterGoal}
                                            onChange={e => {
                                                const goal = parseInt(e.target.value) || 3000;
                                                setWaterGoal(goal);
                                                saveData({waterGoal: goal});
                                            }}
                                            className="w-full bg-slate-950 border border-slate-800 p-3 rounded-lg text-white outline-none focus:border-blue-500"
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Reiniciar Semana */}
                            <div className="bg-slate-900 p-5 rounded-2xl border border-slate-800">
                                <h3 className="text-sm font-black uppercase text-orange-400 mb-3">Reiniciar Progreso</h3>
                                <p className="text-xs text-slate-500 mb-4">Borra las series completadas de la semana actual</p>
                                <button
                                    onClick={() => {
                                        if (confirm('¬øSeguro que quer√©s reiniciar la semana actual?')) {
                                            const newSets = {};
                                            Object.keys(completedSets).forEach(key => {
                                                if (!key.startsWith(`${currentWeek}-`)) {
                                                    newSets[key] = completedSets[key];
                                                }
                                            });
                                            setCompletedSets(newSets);
                                            saveData({completedSets: newSets});
                                        }
                                    }}
                                    className="w-full bg-orange-900/20 border border-orange-900 text-orange-400 p-3 rounded-lg font-bold text-sm active:scale-95 transition-all"
                                >
                                    Reiniciar Semana {currentWeek}
                                </button>
                            </div>

                            {/* Cerrar Sesi√≥n */}
                            <button
                                onClick={() => {
                                    if (confirm('¬øSeguro que quer√©s salir?')) {
                                        localStorage.removeItem('pablo_session');
                                        window.location.reload();
                                    }
                                }}
                                className="w-full bg-red-900/20 border border-red-900 text-red-400 p-4 rounded-lg font-bold uppercase text-sm active:scale-95 transition-all"
                            >
                                Cerrar Sesi√≥n
                            </button>
                        </div>
                    </div>
                );
            };

            // VISTA WORKOUT (mantenida de v2)
            const WorkoutView = () => (
                <div className="max-w-md mx-auto min-h-screen pb-24 fade-in">
                    <header className="sticky top-0 z-50 bg-slate-950/95 backdrop-blur-md p-4 flex justify-between items-center border-b border-slate-800">
                        <i className="fas fa-dumbbell text-blue-500 text-xl"></i>
                        <div className="flex items-center gap-3 bg-slate-900 rounded-full px-4 py-2 border border-slate-700">
                            <button 
                                onClick={() => { 
                                    const w = Math.max(1, currentWeek-1); 
                                    setCurrentWeek(w); 
                                    saveData({currentWeek: w}); 
                                }}
                                className="active:scale-90 transition-transform"
                            >
                                <i className="fas fa-chevron-left text-xs text-slate-400 p-1"></i>
                            </button>
                            <span className="font-black text-sm uppercase italic w-16 text-center">Sem {currentWeek}</span>
                            <button 
                                onClick={() => { 
                                    const w = Math.min(24, currentWeek+1); 
                                    setCurrentWeek(w); 
                                    saveData({currentWeek: w}); 
                                }}
                                className="active:scale-90 transition-transform"
                            >
                                <i className="fas fa-chevron-right text-xs text-slate-400 p-1"></i>
                            </button>
                        </div>
                        <div className="flex items-center gap-2">
                            {syncStatus === 'syncing' && <i className="fas fa-sync animate-spin text-blue-400 text-sm"></i>}
                            {syncStatus === 'success' && <i className="fas fa-cloud-upload-alt text-emerald-400 text-sm"></i>}
                            {syncStatus === 'error' && <i className="fas fa-exclamation-circle text-red-400 text-sm"></i>}
                            {syncStatus === 'idle' && <i className="fas fa-save text-emerald-600 text-sm"></i>}
                        </div>
                    </header>

                    <main className="p-4 space-y-6">
                        <div className="grid grid-cols-2 gap-3">
                            <div className="bg-gradient-to-br from-slate-900 to-slate-950 p-4 rounded-2xl border border-slate-800 shadow-xl">
                                <p className="text-[10px] uppercase font-black text-slate-500 mb-1">Carga Actual</p>
                                <p className="text-2xl font-black text-emerald-400 italic">{stats.sets}x{stats.reps}</p>
                                <p className="text-[9px] text-slate-600 font-bold mt-1">
                                    {stats.increment > 0 ? `+${stats.increment}kg base` : 'Peso base'}
                                </p>
                                <p className="text-[8px] text-blue-500 font-bold mt-1">
                                    {((currentWeek - 1) % 4) === 3 ? '¬°Pr√≥xima sem +2.5kg!' : `Sem ${((currentWeek - 1) % 4) + 1} de 4`}
                                </p>
                            </div>
                            <div className={`bg-gradient-to-br from-slate-900 to-slate-950 p-4 rounded-2xl border transition-all duration-300 shadow-xl ${isTimerActive ? 'border-blue-500 shadow-blue-600/20' : 'border-slate-800'}`}>
                                <p className="text-[10px] uppercase font-black text-blue-400 mb-1">Descanso</p>
                                <p className="text-2xl font-black italic text-white">
                                    {timer > 0 ? `${Math.floor(timer/60)}:${(timer%60).toString().padStart(2,'0')}` : "0:00"}
                                </p>
                                <div className="flex gap-1 mt-2">
                                    <button
                                        onClick={startTimer}
                                        className="flex-1 bg-blue-600/20 text-blue-400 text-[9px] font-bold py-1 rounded active:scale-95 transition-all"
                                    >
                                        INICIAR
                                    </button>
                                    <button
                                        onClick={stopTimer}
                                        className="flex-1 bg-slate-950 text-slate-600 text-[9px] font-bold py-1 rounded active:scale-95 transition-all"
                                    >
                                        PARAR
                                    </button>
                                </div>
                            </div>
                        </div>

                        {routine.map(day => (
                            <section key={day.id} className="space-y-4">
                                <h2 className="text-xl font-black uppercase italic border-l-4 border-blue-500 pl-3">{day.title}</h2>
                                {day.ex.map((e, i) => (
                                    <div key={i} className="bg-gradient-to-br from-slate-900 to-slate-950 p-5 rounded-3xl border border-slate-800 space-y-4 shadow-xl">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h3 className="font-black text-lg uppercase italic text-white leading-none">{e.name}</h3>
                                                <p className="text-[10px] font-bold text-blue-400 mt-2 uppercase tracking-widest">
                                                    Peso: {typeof e.w === 'number' ? e.w + 'kg' : e.w} ‚Ä¢ {e.s}x{e.r}
                                                </p>
                                            </div>
                                        </div>
                                        
                                        {e.wu && (
                                            <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                                                {[0.5, 0.7, 0.9].map((pct, wi) => {
                                                    const key = `${currentWeek}-${day.id}-${e.name}-warmup-${wi}`;
                                                    const done = completedSets[key];
                                                    const warmupWeight = Math.round(e.w * pct);
                                                    return (
                                                        <button 
                                                            key={wi} 
                                                            onClick={() => toggleSet(day.id, e.name, wi, true, warmupWeight, e.s, e.r)} 
                                                            className={`shrink-0 px-4 py-2 rounded-full text-[10px] font-black border transition-all active:scale-90 ${done ? 'bg-orange-500 border-orange-400 text-white shadow-lg' : 'bg-slate-950 border-slate-700 text-slate-500'}`}
                                                        >
                                                            {warmupWeight}kg
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                        )}
                                        
                                        <div className="grid grid-cols-4 gap-2">
                                            {Array.from({length: e.s}).map((_, si) => {
                                                const key = `${currentWeek}-${day.id}-${e.name}-work-${si}`;
                                                const done = completedSets[key];
                                                return (
                                                    <button 
                                                        key={si} 
                                                        onClick={() => toggleSet(day.id, e.name, si, false, e.w, e.s, e.r)} 
                                                        className={`aspect-square rounded-2xl flex items-center justify-center font-black text-xl border-2 transition-all active:scale-90 ${done ? 'bg-emerald-600 border-emerald-400 text-white shadow-lg shadow-emerald-500/30 pulse-success' : 'bg-slate-950 border-slate-700 text-slate-600'}`}
                                                    >
                                                        {done ? <i className="fas fa-check"></i> : si + 1}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </section>
                        ))}
                    </main>
                </div>
            );

            // RENDERIZADO PRINCIPAL Y NAVEGACI√ìN
            return (
                <>
                    {currentView === 'workout' && <WorkoutView />}
                    {currentView === 'nutrition' && <NutritionView />}
                    {currentView === 'calendar' && <CalendarView />}
                    {currentView === 'history' && <HistoryView />}
                    {currentView === 'settings' && <SettingsView />}

                    {/* Modales */}
                    {showRunningModal && <RunningModal />}
                    {showFootballModal && <FootballModal />}
                    {showMealModal && <MealModal />}
                    {showMeasurementModal && <MeasurementModal />}
                    {showWellnessModal && <WellnessModal />}
                    {showDayModal && <DayModal />}

                    {/* Bottom Navigation - 4 PESTA√ëAS */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-slate-950/95 backdrop-blur-md border-t border-slate-800 p-2 flex justify-around items-center max-w-md mx-auto z-40">
                        <button
                            onClick={() => setCurrentView('workout')}
                            className={`flex flex-col items-center gap-1 px-1 py-2 rounded-xl transition-all ${currentView === 'workout' ? 'text-blue-400' : 'text-slate-600'}`}
                        >
                            <i className="fas fa-dumbbell text-sm"></i>
                            <span className="text-[7px] font-black uppercase">Entreno</span>
                        </button>
                        <button
                            onClick={() => setCurrentView('nutrition')}
                            className={`flex flex-col items-center gap-1 px-1 py-2 rounded-xl transition-all ${currentView === 'nutrition' ? 'text-purple-400' : 'text-slate-600'}`}
                        >
                            <i className="fas fa-utensils text-sm"></i>
                            <span className="text-[7px] font-black uppercase">Nutrici√≥n</span>
                        </button>
                        <button
                            onClick={() => setCurrentView('calendar')}
                            className={`flex flex-col items-center gap-1 px-1 py-2 rounded-xl transition-all ${currentView === 'calendar' ? 'text-yellow-400' : 'text-slate-600'}`}
                        >
                            <i className="fas fa-calendar-alt text-sm"></i>
                            <span className="text-[7px] font-black uppercase">Calendario</span>
                        </button>
                        <button
                            onClick={() => setCurrentView('history')}
                            className={`flex flex-col items-center gap-1 px-1 py-2 rounded-xl transition-all ${currentView === 'history' ? 'text-emerald-400' : 'text-slate-600'}`}
                        >
                            <i className="fas fa-list text-sm"></i>
                            <span className="text-[7px] font-black uppercase">Historial</span>
                        </button>
                        <button
                            onClick={() => setCurrentView('settings')}
                            className={`flex flex-col items-center gap-1 px-1 py-2 rounded-xl transition-all ${currentView === 'settings' ? 'text-blue-400' : 'text-slate-600'}`}
                        >
                            <i className="fas fa-cog text-sm"></i>
                            <span className="text-[7px] font-black uppercase">Config</span>
                        </button>
                    </nav>

                    {/* Install Prompt */}
                    {showInstallPrompt && (
                        <div className="fixed bottom-20 left-4 right-4 max-w-md mx-auto install-prompt">
                            <div className="bg-gradient-to-r from-blue-600 to-blue-500 p-4 rounded-2xl shadow-2xl border border-blue-400/30">
                                <div className="flex items-start gap-3">
                                    <i className="fas fa-mobile-alt text-white text-2xl mt-1"></i>
                                    <div className="flex-1">
                                        <h3 className="font-black text-white text-sm mb-1">Instal√° la App</h3>
                                        <p className="text-blue-100 text-xs mb-3">Agregala a tu pantalla de inicio</p>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={handleInstall}
                                                className="bg-white text-blue-600 px-4 py-2 rounded-lg font-black text-xs uppercase active:scale-95 transition-all"
                                            >
                                                Instalar
                                            </button>
                                            <button
                                                onClick={() => setShowInstallPrompt(false)}
                                                className="bg-blue-700/50 text-white px-4 py-2 rounded-lg font-bold text-xs active:scale-95 transition-all"
                                            >
                                                Ahora no
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'entreno-pablo-v3';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(() => console.log('SW OK'))
                    .catch(err => console.log('SW Error:', err));
            });
        }
    </script>
</body>
</html>
